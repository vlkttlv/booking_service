{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" href="{{ url_for('static', path='style/bookings.css') }}">
<script>
   const payBooking = (event, booking_id) => {
       event.preventDefault();
       window.location.href = `/v1/pages/payments/pay?booking_id=${booking_id}`;
   }

    async function deleteBooking(booking_id) {
      const bookingId = document.getElementById("bookingId").value;
      const url = "/v1/bookings/" + booking_id;
      await fetch(url, {
              method: 'DELETE',
              headers: {'Accept': 'accept: */*'}, 
      }).then(response => {
                  if (response.status === 200) {
                    alert('–ë—Ä–æ–Ω—å —É–¥–∞–ª–µ–Ω–∞. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É');
                    window.location.href = "/pages/bookings"
                    }
                    })
                  };
</script>
<script>
    async function loginUser() {
        const url = "/api/v1/auth/logout";        
        await fetch(url, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({email: email, password: password}),
            }).then(response => {
                if (response.status === 200) {
                    window.location.href = "/pages/bookings"
                } else {
                    wrongCredentialsSpan.textContent = "–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å";
                }
            });
        }
        </script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

{% endblock %}

{% block content %}
{% if bookings %}
<div class="hotel-list"> 
    {% for booking in bookings %}
    <div class="hotel-card">
        <div class="hotel-images">
            <div id="carouselExample" class="carousel slide" data-ride="carousel">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="{{ url_for('static', path='images/rooms/' + booking.room_id|string + '_1.webp') }}" alt="image_1" class="d-block w-100" width="200" height="200">
                </div>
                <div class="carousel-item">
                  <img src="{{ url_for('static', path='images/rooms/' + booking.room_id|string + '_2.webp') }}" alt="image_2" class="d-block w-100" width="200" height="200">
                </div>
                <div class="carousel-item">
                  <img src="{{ url_for('static', path='images/rooms/' + booking.room_id|string + '_3.webp') }}" alt="image_3" class="d-block w-100" width="200" height="200">
                </div>
              </div>
              <a class="carousel-control-prev" href="#carouselExample" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#carouselExample" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>
          </div>
      <div class="hotel-info">
        <h2 class="hotel-name">{{ booking.name }}</h2>
        {% if booking.description %}
        <div >{{ booking.description }}</div>
        {% endif %}
        <div >{{ " ¬∑ ".join(booking.services) }}</div>
        <div>
            <span>‚úÖ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ</span>
            <span>—Å {{ booking.date_from }}</span>
            <span>–ø–æ {{ booking.date_to }}</span>
        </div>
        <div >
            <span >üíµ {{ booking.total_cost }} —Ä—É–±–ª–µ–π </span>
            <span>–∑–∞ {{ booking.total_days }} –Ω–æ—á–µ–π</span>
            <span hidden id="bookingId">{{ booking.id }}</span>
        </div>
        {% if booking.payment_status == "not paid" %}
        <button onclick="payBooking(event, '{{booking.id}}')" class="book-button">–û–ø–ª–∞—Ç–∏—Ç—å</button>
        {% endif %}
        <button onclick="deleteBooking('{{ booking.id }}')" class="book-button">–û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å</button>
      </div>

    </div>
    {% endfor %}
  </div>
  {% else %}
  <script>
    alert('–£ –≤–∞—Å –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–∏—â–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É')
    window.location.href = "/v1/pages/main"
  </script>
  {% endif%}
{% endblock %}